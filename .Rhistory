# Remove Primera Catalana
leagues
# Read list of leagues
leagues <- read_csv("leagues.csv", col_types = cols())
setwd("~/Google Drive/Futbol")
# Select leagues to be updated
leagues <- leagues[1:7,] # La Liga, Seg A, Primera Fem, Primera Cat
# Remove Primera Catalana
leagues <- leagues %>% filter(code != "primera_catalana")
leagues
setwd("~/Google Drive/Futbol")
# Read list of leagues
leagues <- read_csv("leagues.csv", col_types = cols())
leagues
# Select leagues to be updated
leagues <- leagues[1:7,] # La Liga, Seg A, Primera Fem, Primera Cat
leagues
# Remove Primera Catalana
leagues <- leagues %>% filter(code != "primera_catalana")
leagues
for (i in 1:nrow(leagues)){
# Basics
lg.name <- as.character(leagues[i,1])
lg.code <- as.character(leagues[i,2])
lg.type1 <- as.character(leagues[i,7])
lg.type2 <- as.character(leagues[i,8])
lg.gender <- as.character(leagues[i,9])
lg.stub <- tolower(gsub("[[:punct:]]", "", lg.name))
lg.stub <- gsub("[[:space:]]", "-", lg.stub)
# Find Campió Projectat
campio <- aa.final.table %>% filter(league == lg.code) %>% arrange(desc(proj.points))
campio <- campio[1,1]
campio <- campio %>% left_join(teamnames, by = "team")
campio <- as.character(campio[1,2])
# Write page
dashes <- '---'
l1 <- 'date: "2020-06-17"'
l2 <- 'image:'
l3 <- '  preview_only: true'
l4 <- paste0('summary: Campió Projectat, ',campio)
l5 <- 'tags:'
l6a <- '  - 2020-2021'
l6b <- paste0('  - ',lg.gender)
l7 <- paste0('title: ', lg.name)
l8 <- '### Projecció de la classificació final'
l9 <- paste0(" | [Trajectòria dels equips](/competicions/",lg.stub,"-trajectoria/) |")
br <- '<br>'
start <- '```{r echo=F,warning=FALSE,message=FALSE}'
l10 <- 'suppressMessages(library(dplyr))'
l11 <- 'suppressMessages(library(kableExtra))'
l12 <- 'teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv")'
l13 <- 'table <- read.csv("~/Google Drive/Futbol/data_tables.csv")'
l14 <- paste0("table <- table %>% filter(league == '", lg.code, "')")
l15 <- 'table <- teamnames %>% left_join(table, by = "team") %>% arrange(desc(proj.points))'
l16 <- "table <- table[complete.cases(table),]"
l17 <- 'table$linkteam <- iconv(table$fullname,to="ASCII//TRANSLIT")'
l18 <- 'table$linkteam <- tolower(gsub("[[:punct:]]", "", table$linkteam))'
l19 <- 'table$linkteam <- gsub("[[:space:]]", "-", table$linkteam)'
l20 <- 'table$team <- paste0("[", table$shortname, "](/clubs/", table$linkteam,"-",table$league,")")'
l21 <- 'table <- table %>% select(-shortname,-fullname,-league,-linkteam, -typex)'
l21x <- 'table <- table %>% select(-shortname,-fullname,-league,-linkteam)'
l22 <- paste0("kable(table, digits = 1, align = 'lcccccccc', row.names = FALSE, col.names = c('Club', 'Punts', 'GD', '", lg.type1, "', '", lg.type2,"', 'Descens', 'Favor', 'Contra', 'Qualitat')) %>% add_header_above(c('Projecció de la Classificació' = 1, 'Final' = 2, 'Probabilitat (%)' = 3, 'xGols' = 3)) %>% column_spec(1, bold = T) %>% column_spec(3, border_right = T) %>% column_spec(6, border_right = T)")
l22x <- paste0("kable(table, digits = 1, align = 'lccccccccc', row.names = FALSE, col.names = c('Club', 'Punts', 'GD', '", lg.type1, "', '", lg.type2,"', 'Europa', 'Descens', 'Favor', 'Contra', 'Qualitat')) %>% add_header_above(c('Projecció de la Classificació' = 1, 'Final' = 2, 'Probabilitat (%)' = 4, 'xGols' = 3)) %>% column_spec(1, bold = T) %>% column_spec(3, border_right = T) %>% column_spec(7, border_right = T)")
end <- "```"
teamfolder <- paste0("~/futstatcat/content/competicions/",lg.stub)
setwd(teamfolder)
writeLines(c(dashes,l1,l2,l3,l4,l5,l6a,l6b,l7,dashes,l9,br,br,start,l10,l11,l12,l13,l14,l15,l16,l17,l18,l19,l20,l21,l22,end), "index.rmd")
if (lg.code == "primera"){writeLines(c(dashes,l1,l2,l3,l4,l5,l6a,l6b,l7,dashes,l9,br,br,start,l10,l11,l12,l13,l14,l15,l16,l17,l18,l19,l20,l21x,l22x,end), "index.rmd")}
}
# Refresh Pages
to_update <- c("~/futstatcat/content/competicions/la-liga-trajectoria/index.rmd",
"~/futstatcat/content/competicions/segona-a-trajectoria/index.rmd",
"~/futstatcat/content/competicions/primera-trajectoria/index.rmd",
"~/futstatcat/content/covid-19/index.rmd")
for (i in to_update){
temp <- read_file(i)
write_file(temp,i)
}
# Start site
setwd("~/futstatcat")
stop_server()
serve_site()
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '/Manlleu')
h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == 'primera_catalana_1')
type1 <- as.numeric(h[NA,2] + h[NA,2])/2
type2 <- as.numeric(h[NA,2] + h[NA,2])/2
type3 <- as.numeric(h[NA,2] + h[NA,2])/2
p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = 'NA', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type2), linetype='dashed', color='#5c5c5c') + annotate('text',0,type2,label = 'NA', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type3), linetype='dashed', color='#5c5c5c') + annotate('text',0,type3,label = 'Descens', vjust = -.5, hjust = 'left', color='#5c5c5c')
p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")
leagues <- read_csv("leagues.csv", col_types = cols())
# Select leagues to be updated
leagues <- leagues[1:7,] # La Liga, Seg A, Primera Fem, Primera Cat
setwd("~/Google Drive/Futbol")
leagues <- read_csv("leagues.csv", col_types = cols())
# Select leagues to be updated
leagues <- leagues[1:7,] # La Liga, Seg A, Primera Fem, Primera Cat
clubs <- aa.final.table %>% select(team, league)
clubs <- clubs %>% left_join(teamnames, by = "team")
lgs <- leagues
colnames(lgs)[2] <- "league"
colnames(lgs)[1] <- "lg.name"
clubs <- clubs %>% left_join(lgs, by = "league")
clubs
tail(clubs)
View(clubs)
lgs
clubs
lgs
lgs
lgs
lgs[2,3:7]
lgs[3:7,2]
lgs[3:6,2]
View(aa.final.table)
lgs[3:6,2] <- c("primera_catalana_1", "primera_catalana_2", "primera_catalana_3", "primera_catalana_4")
lgs
lg.code %in% "div"
lg.code == "prim*"
lg.code == "prim"*
any(grepl("prim", lg.code))
any(grepl("cat", lg.code))
any(grepl("div", lg.code))
any(grepl("cat", lg.code))
teamnames <- read_csv("~/Google Drive/Futbol/teamlist.csv", col_types = cols())
# Team pages
clubs <- aa.final.table %>% select(team, league)
clubs <- clubs %>% left_join(teamnames, by = "team")
lgs <- leagues
colnames(lgs)[2] <- "league"
colnames(lgs)[1] <- "lg.name"
lgs[3:6,2] <- c("primera_catalana_1", "primera_catalana_2", "primera_catalana_3", "primera_catalana_4")
clubs <- clubs %>% left_join(lgs, by = "league")
for (i in 1:nrow(clubs)){
club <- as.character(clubs[i,1])
lg.code <- as.character(clubs[i,2])
lg.name <- as.character(clubs[i,5])
club.name <- as.character(clubs[i,4])
type1 <- as.numeric(clubs[i,7])
type2 <- as.numeric(clubs[i,8])
type3 <- as.numeric(clubs[i,9])
name1 <- as.character(clubs[i,10])
name2 <- as.character(clubs[i,11])
dashes <- '---'
br <- '<br>'
start <- '```{r echo=F,warning=FALSE,message=FALSE}'
end <- "```"
l1 <- 'date: "2020-06-17"'
l2 <- paste0("title: '", club.name, "'")
l3 <- paste0("subtitle: '", lg.name,"'")
l4 <- paste0("summary: '", lg.name,"'")
l5 <- '### Trajectòria'
start2 <- "```{r fig.width=8, fig.height=5, echo=F,warning=FALSE,message=FALSE}"
l6 <- 'suppressMessages(library(dplyr))'
l7 <- 'suppressMessages(library(ggplot2))'
l8 <- paste0("d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '",club,"')")
l9 <- paste0("h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == '",lg.code,"')")
l10a <- paste0("type1 <- as.numeric(h[",type1,",2] + h[",(type1+1),",2])/2")
l10b <- paste0("type2 <- as.numeric(h[",type2,",2] + h[",(type2-1),",2])/2")
l10c <- paste0("type3 <- as.numeric(h[",type3,",2] + h[",(type3+1),",2])/2")
l11 <- paste0("p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = '",name1,"', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type2), linetype='dashed', color='#5c5c5c') + annotate('text',0,type2,label = '",name2,"', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type3), linetype='dashed', color='#5c5c5c') + annotate('text',0,type3,label = 'Descens', vjust = -.5, hjust = 'left', color='#5c5c5c')")
l12 <- 'p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")'
space <- " "
l15 <- '### Pròxims partits'
l16 <- 'suppressMessages(library(kableExtra))'
l17 <- 'teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv") %>% select(-fullname)'
l18 <- 'games <- read.csv("~/Google Drive/Futbol/data_games.csv")'
l19 <- paste0("games <- games %>% filter(team1 == '",club,"' | team2 == '",club,"')")
l20 <- 'if (nrow(games>0)){names(teamnames) <- c("home", "team1")'
l21 <- 'games <- games %>% left_join(teamnames, by = "team1")'
l22 <- 'names(teamnames) <- c("away", "team2")'
l23 <- 'games <- games %>% left_join(teamnames, by = "team2") %>% select(jornada, home, p1, pd, p2, away)'
l24 <- 'kable(games, digits = 1, align = "c", row.names = FALSE, col.names = c("Jornada", "Equip", "Guanyar", "Empatar", "Guanyar", "Equip")) %>% add_header_above(c("2019-20" = 1, "Local" = 2, "(%)" = 1, "Visitant" = 2)) %>% column_spec(2, bold = T) %>% column_spec(6, bold = T)}'
filename <- iconv(club.name,to="ASCII//TRANSLIT")
filename <- tolower(gsub("[[:punct:]]", "", filename))
filename <- paste0(filename,"-",lg.code,".rmd")
filename <- gsub("[[:space:]]", "-", filename)
setwd("~/futstatcat/content/clubs")
writeLines(c(dashes,l1,l2,l3,l4,dashes,l5,start2,l6,l7,l8,l9,l10a,l10b,l10c,l11,l12,end,space,l15,start,l16,l17,l18,l19,l20,l21,l22,l23,l24,end), filename)
if(any(grepl("cat", lg.code))){writeLines(c(dashes,l1,l2,l3,l4,dashes,l5,start2,l6,l7,l8,l9,l10a,l11,l12,end,space,l15,start,l16,l17,l18,l19,l20,l21,l22,l23,l24,end), filename)}
}
setwd("~/futstatcat")
stop_server()
serve_site()
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '/Manlleu')
h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == 'primera_catalana_1')
type1 <- as.numeric(h[4,2] + h[5,2])/2
p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = 'Campió', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type2), linetype='dashed', color='#5c5c5c') + annotate('text',0,type2,label = 'Playoffs', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type3), linetype='dashed', color='#5c5c5c') + annotate('text',0,type3,label = 'Descens', vjust = -.5, hjust = 'left', color='#5c5c5c')
p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")
for (i in 1:nrow(clubs)){
club <- as.character(clubs[i,1])
lg.code <- as.character(clubs[i,2])
lg.name <- as.character(clubs[i,5])
club.name <- as.character(clubs[i,4])
type1 <- as.numeric(clubs[i,7])
type2 <- as.numeric(clubs[i,8])
type3 <- as.numeric(clubs[i,9])
name1 <- as.character(clubs[i,10])
name2 <- as.character(clubs[i,11])
dashes <- '---'
br <- '<br>'
start <- '```{r echo=F,warning=FALSE,message=FALSE}'
end <- "```"
l1 <- 'date: "2020-06-17"'
l2 <- paste0("title: '", club.name, "'")
l3 <- paste0("subtitle: '", lg.name,"'")
l4 <- paste0("summary: '", lg.name,"'")
l5 <- '### Trajectòria'
start2 <- "```{r fig.width=8, fig.height=5, echo=F,warning=FALSE,message=FALSE}"
l6 <- 'suppressMessages(library(dplyr))'
l7 <- 'suppressMessages(library(ggplot2))'
l8 <- paste0("d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '",club,"')")
l9 <- paste0("h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == '",lg.code,"')")
l10a <- paste0("type1 <- as.numeric(h[",type1,",2] + h[",(type1+1),",2])/2")
l10b <- paste0("type2 <- as.numeric(h[",type2,",2] + h[",(type2-1),",2])/2")
l10c <- paste0("type3 <- as.numeric(h[",type3,",2] + h[",(type3+1),",2])/2")
l11 <- paste0("p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = '",name1,"', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type2), linetype='dashed', color='#5c5c5c') + annotate('text',0,type2,label = '",name2,"', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type3), linetype='dashed', color='#5c5c5c') + annotate('text',0,type3,label = 'Descens', vjust = -.5, hjust = 'left', color='#5c5c5c')")
l11alt <- paste0("p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = '",name1,"', vjust = -.5, hjust = 'left', color='#5c5c5c')")
l12 <- 'p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")'
space <- " "
l15 <- '### Pròxims partits'
l16 <- 'suppressMessages(library(kableExtra))'
l17 <- 'teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv") %>% select(-fullname)'
l18 <- 'games <- read.csv("~/Google Drive/Futbol/data_games.csv")'
l19 <- paste0("games <- games %>% filter(team1 == '",club,"' | team2 == '",club,"')")
l20 <- 'if (nrow(games>0)){names(teamnames) <- c("home", "team1")'
l21 <- 'games <- games %>% left_join(teamnames, by = "team1")'
l22 <- 'names(teamnames) <- c("away", "team2")'
l23 <- 'games <- games %>% left_join(teamnames, by = "team2") %>% select(jornada, home, p1, pd, p2, away)'
l24 <- 'kable(games, digits = 1, align = "c", row.names = FALSE, col.names = c("Jornada", "Equip", "Guanyar", "Empatar", "Guanyar", "Equip")) %>% add_header_above(c("2019-20" = 1, "Local" = 2, "(%)" = 1, "Visitant" = 2)) %>% column_spec(2, bold = T) %>% column_spec(6, bold = T)}'
filename <- iconv(club.name,to="ASCII//TRANSLIT")
filename <- tolower(gsub("[[:punct:]]", "", filename))
filename <- paste0(filename,"-",lg.code,".rmd")
filename <- gsub("[[:space:]]", "-", filename)
setwd("~/futstatcat/content/clubs")
writeLines(c(dashes,l1,l2,l3,l4,dashes,l5,start2,l6,l7,l8,l9,l10a,l10b,l10c,l11,l12,end,space,l15,start,l16,l17,l18,l19,l20,l21,l22,l23,l24,end), filename)
if(any(grepl("cat", lg.code))){writeLines(c(dashes,l1,l2,l3,l4,dashes,l5,start2,l6,l7,l8,l9,l10a,l11alt,l12,end,space,l15,start,l16,l17,l18,l19,l20,l21,l22,l23,l24,end), filename)}
}
setwd("~/futstatcat")
stop_server()
serve_site()
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '/L-Escala')
h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == 'primera_catalana_1')
type1 <- as.numeric(h[4,2] + h[5,2])/2
p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = 'Campió', vjust = -.5, hjust = 'left', color='#5c5c5c')
p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")
suppressMessages(library(kableExtra))
teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv") %>% select(-fullname)
games <- read.csv("~/Google Drive/Futbol/data_games.csv")
games <- games %>% filter(team1 == '/L-Escala' | team2 == '/L-Escala')
if (nrow(games>0)){names(teamnames) <- c("home", "team1")
games <- games %>% left_join(teamnames, by = "team1")
names(teamnames) <- c("away", "team2")
games <- games %>% left_join(teamnames, by = "team2") %>% select(jornada, home, p1, pd, p2, away)
kable(games, digits = 1, align = "c", row.names = FALSE, col.names = c("Jornada", "Equip", "Guanyar", "Empatar", "Guanyar", "Equip")) %>% add_header_above(c("2019-20" = 1, "Local" = 2, "(%)" = 1, "Visitant" = 2)) %>% column_spec(2, bold = T) %>% column_spec(6, bold = T)}
setwd("~/futstatcat")
stop_server()
serve_site()
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '/Manlleu')
h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == 'primera_catalana_1')
type1 <- as.numeric(h[4,2] + h[5,2])/2
p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = 'Campió', vjust = -.5, hjust = 'left', color='#5c5c5c')
p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '/L-Escala')
h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == 'primera_catalana_1')
type1 <- as.numeric(h[4,2] + h[5,2])/2
p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = 'Campió', vjust = -.5, hjust = 'left', color='#5c5c5c')
p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")
for (i in 1:nrow(clubs)){
club <- as.character(clubs[i,1])
lg.code <- as.character(clubs[i,2])
lg.name <- as.character(clubs[i,5])
club.name <- as.character(clubs[i,4])
type1 <- as.numeric(clubs[i,7])
type2 <- as.numeric(clubs[i,8])
type3 <- as.numeric(clubs[i,9])
name1 <- as.character(clubs[i,10])
name2 <- as.character(clubs[i,11])
dashes <- '---'
br <- '<br>'
start <- '```{r echo=F,warning=FALSE,message=FALSE}'
end <- "```"
l1 <- 'date: "2020-06-17"'
l2 <- paste0("title: '", club.name, "'")
l3 <- paste0("subtitle: '", lg.name,"'")
l4 <- paste0("summary: '", lg.name,"'")
l5 <- '### Trajectòria'
start2 <- "```{r fig.width=8, fig.height=5, echo=F,warning=FALSE,message=FALSE}"
l6 <- 'suppressMessages(library(dplyr))'
l7 <- 'suppressMessages(library(ggplot2))'
l8 <- paste0("d <- read.csv('~/Google Drive/Futbol/data_trajectories.csv') %>% filter(team == '",club,"')")
l9 <- paste0("h <- read.csv('~/Google Drive/Futbol/data_tables.csv') %>% filter(league == '",lg.code,"')")
l10a <- paste0("type1 <- as.numeric(h[",type1,",2] + h[",(type1+1),",2])/2")
l10b <- paste0("type2 <- as.numeric(h[",type2,",2] + h[",(type2-1),",2])/2")
l10c <- paste0("type3 <- as.numeric(h[",type3,",2] + h[",(type3+1),",2])/2")
l11 <- paste0("p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = '",name1,"', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type2), linetype='dashed', color='#5c5c5c') + annotate('text',0,type2,label = '",name2,"', vjust = -.5, hjust = 'left', color='#5c5c5c') + geom_hline(aes(yintercept=type3), linetype='dashed', color='#5c5c5c') + annotate('text',0,type3,label = 'Descens', vjust = -.5, hjust = 'left', color='#5c5c5c')")
l11alt <- paste0("p <- ggplot(data=d) + geom_line(aes(round,points), size = 1.5, color = 'blue') + geom_hline(aes(yintercept=type1), linetype='dashed', color='#5c5c5c') + annotate('text',0,type1,label = '",name1,"', vjust = -.5, hjust = 'left', color='#5c5c5c')")
l12 <- 'p + theme_minimal() + labs(x = "Jornada", y = "Punts Projectats")'
space <- " "
l15 <- '### Pròxims partits'
l16 <- 'suppressMessages(library(kableExtra))'
l17 <- 'teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv") %>% select(-fullname)'
l18 <- 'games <- read.csv("~/Google Drive/Futbol/data_games.csv")'
l19 <- paste0("games <- games %>% filter(team1 == '",club,"' | team2 == '",club,"')")
l20 <- 'if (nrow(games>0)){names(teamnames) <- c("home", "team1")'
l21 <- 'games <- games %>% left_join(teamnames, by = "team1")'
l22 <- 'names(teamnames) <- c("away", "team2")'
l23 <- 'games <- games %>% left_join(teamnames, by = "team2") %>% select(jornada, home, p1, pd, p2, away)'
l24 <- 'kable(games, digits = 1, align = "c", row.names = FALSE, col.names = c("Jornada", "Equip", "Guanyar", "Empatar", "Guanyar", "Equip")) %>% add_header_above(c("2019-20" = 1, "Local" = 2, "(%)" = 1, "Visitant" = 2)) %>% column_spec(2, bold = T) %>% column_spec(6, bold = T)}'
filename <- iconv(club.name,to="ASCII//TRANSLIT")
filename <- tolower(gsub("[[:punct:]]", "", filename))
filename <- paste0(filename,"-",lg.code,".rmd")
filename <- gsub("[[:space:]]", "-", filename)
setwd("~/futstatcat/content/clubs")
writeLines(c(dashes,l1,l2,l3,l4,dashes,l5,start2,l6,l7,l8,l9,l10a,l10b,l10c,l11,l12,end,space,l15,start,l16,l17,l18,l19,l20,l21,l22,l23,l24,end), filename)
if(any(grepl("cat", lg.code))){writeLines(c(dashes,l1,l2,l3,l4,dashes,l5,start2,l6,l7,l8,l9,l10a,l11alt,l12,end,space,l15,start,l16,l17,l18,l19,l20,l21,l22,l23,l24,end), filename)}
}
setwd("~/futstatcat")
stop_server()
serve_site()
setwd("~/futstatcat")
stop_server()
serve_site()
source('~/Google Drive/PhD/Code and Data/phd/paper-one/models.R')
suppressMessages(library(dplyr))
suppressMessages(library(kableExtra))
teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv")
data <- read.csv("~/Google Drive/Futbol/data_tables.csv")
table <- data %>% filter(league == 'primera_catalana_1')
table <- teamnames %>% left_join(table, by = "team") %>% arrange(desc(proj.points))
table <- table[complete.cases(table),]
table <- table %>% select(-fullname,-team, -league)
kable(table, digits = 1, align = 'lccccccc', row.names = FALSE, col.names = c('Club', 'Punts', 'GD', 'Fase Ascens', 'Fase Descens', 'Favor', 'Contra', 'Qualitat')) %>% add_header_above(c('Primer Fase de 2020-2021' = 1, 'Projecció' = 2, 'Probabilitat (%)' = 2, 'xGols' = 3)) %>% column_spec(1, bold = T) %>% column_spec(3, border_right = T) %>% column_spec(5, border_right = T)
table
suppressMessages(library(dplyr))
suppressMessages(library(kableExtra))
teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv")
data <- read.csv("~/Google Drive/Futbol/data_tables.csv")
table <- data %>% filter(league == 'primera_catalana_1')
table <- teamnames %>% left_join(table, by = "team") %>% arrange(desc(proj.points))
table <- table[complete.cases(table),]
table$linkteam <- iconv(table$fullname,to="ASCII//TRANSLIT")
table$linkteam <- tolower(gsub("[[:punct:]]", "", table$linkteam))
table$linkteam <- gsub("[[:space:]]", "-", table$linkteam)
table$team <- paste0("[", table$shortname, "](/clubs/", table$linkteam,"-",table$league,")")
table <- table %>% select(-fullname,-team, -league, -type2, -typex, -linkteam)
kable(table, digits = 1, align = 'lccccccc', row.names = FALSE, col.names = c('Club', 'Punts', 'GD', 'Fase Ascens', 'Fase Descens', 'Favor', 'Contra', 'Qualitat')) %>% add_header_above(c('Projecció del Primer Fase' = 1, 'Projecció' = 2, 'Probabilitat (%)' = 2, 'xGols' = 3)) %>% column_spec(1, bold = T) %>% column_spec(3, border_right = T) %>% column_spec(5, border_right = T)
suppressMessages(library(dplyr))
suppressMessages(library(kableExtra))
teamnames <- read.csv("~/Google Drive/Futbol/teamlist.csv")
data <- read.csv("~/Google Drive/Futbol/data_tables.csv")
table <- data %>% filter(league == 'primera_catalana_1')
table <- teamnames %>% left_join(table, by = "team") %>% arrange(desc(proj.points))
table <- table[complete.cases(table),]
table$linkteam <- iconv(table$fullname,to="ASCII//TRANSLIT")
table
table$linkteam <- tolower(gsub("[[:punct:]]", "", table$linkteam))
table$linkteam <- gsub("[[:space:]]", "-", table$linkteam)
table
table$team <- paste0("[", table$shortname, "](/clubs/", table$linkteam,"-",table$league,")")
table
table$team <- paste0("[", table$shortname, "](/clubs/", table$linkteam,"-",table$league,")")
table
table <- table %>% select(-fullname,-team, -league, -type2, -typex, -linkteam)
table
to_update <- c("~/futstatcat/content/competicions/la-liga-trajectoria/index.rmd",
"~/futstatcat/content/competicions/segona-a-trajectoria/index.rmd",
"~/futstatcat/content/competicions/primera-trajectoria/index.rmd",
"~/futstatcat/content/competicions/primera-catalana/index.rmd",
"~/futstatcat/content/covid-19/index.rmd")
for (i in to_update){
temp <- read_file(i)
write_file(temp,i)
}
# FutStat.cat
source("~/Google Drive/Futbol/futstat.R")
# FutStat.cat
source("~/Google Drive/Futbol/futstat.R")
source("~/Google Drive/KBO/2020elo.R")
source("~/Google Drive/KBO/2020stats.R")
source("~/Google Drive/Futbol/c19update.R")
suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))
# Read in stats and fix times
swimstats <- read_csv("~/Google Drive/Personal Documents/swimstats.csv", col_types = cols())
swimstats$time <- duration(as.numeric(sub("s.*", "", swimstats$time)), "seconds")
swimstats$fast.50 <- duration(as.numeric(sub("s.*", "", swimstats$fast.50)), "seconds")
swimstats$fast.100 <- duration(as.numeric(sub("s.*", "", swimstats$fast.100)), "seconds")
swimstats$fast.200 <- duration(as.numeric(sub("s.*", "", swimstats$fast.200)), "seconds")
# Add new swim
newswim <- tibble(as_date("2020-10-05"), # Date
duration(60*43+6, "seconds"), # Time
1500, # Meters
388, # Calories
duration(49.6, "seconds"), # Fastest 50m Freestyle
duration(60*1+51.9, "seconds"), # Fastest 100m Freestyle
NA, # Fastest 200m Freestyle
575, # Longest Continuous Distance
2.62, # Meters Per Stroke (DPS)
3.34) # Seconds Per Stroke (Stroke Rate)
newswim[1,11] <- (newswim[1,9]/newswim[1,10]) # Meters Per Second
swimstats[(nrow(swimstats)+1),] <- newswim
# Overwrite csv
write_csv(swimstats,"~/Google Drive/Personal Documents/swimstats.csv")
# PRs and Totals
source("~/Google Drive/Personal Documents/swimpr.R")
# Plots
#ggplot(swimstats %>% filter(date>as.Date("2020-03-01"))) + geom_point(aes(date,meters.per.sec))
#ggplot(swimstats) + geom_point(aes(calories,meters))
source("~/Google Drive/Futbol/c19update.R")
(5*60)+39.9-35.7-38.4
suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))
# Read in stats and fix times
swimstats <- read_csv("~/Google Drive/Personal Documents/swimstats.csv", col_types = cols())
swimstats$time <- duration(as.numeric(sub("s.*", "", swimstats$time)), "seconds")
swimstats$fast.50 <- duration(as.numeric(sub("s.*", "", swimstats$fast.50)), "seconds")
swimstats$fast.100 <- duration(as.numeric(sub("s.*", "", swimstats$fast.100)), "seconds")
swimstats$fast.200 <- duration(as.numeric(sub("s.*", "", swimstats$fast.200)), "seconds")
# Add new swim
newswim <- tibble(as_date("2020-10-06"), # Date
duration(60*54+33, "seconds"), # Time
1800, # Meters
485, # Calories
duration(44.9, "seconds"), # Fastest 50m Freestyle
duration(60*1+43.6, "seconds"), # Fastest 100m Freestyle
duration(265.8, "seconds"), # Fastest 200m Freestyle
400, # Longest Continuous Distance
2.56, # Meters Per Stroke (DPS)
3.23) # Seconds Per Stroke (Stroke Rate)
newswim[1,11] <- (newswim[1,9]/newswim[1,10]) # Meters Per Second
swimstats[(nrow(swimstats)+1),] <- newswim
# Overwrite csv
write_csv(swimstats,"~/Google Drive/Personal Documents/swimstats.csv")
# PRs and Totals
source("~/Google Drive/Personal Documents/swimpr.R")
# Plots
#ggplot(swimstats %>% filter(date>as.Date("2020-03-01"))) + geom_point(aes(date,meters.per.sec))
#ggplot(swimstats) + geom_point(aes(calories,meters))
ggplot(swimstats %>% filter(date>as.Date("2020-03-01"))) + geom_point(aes(date,meters.per.sec))
ggplot(swimstats %>% filter(date>as.Date("2020-09-01"))) + geom_point(aes(date,meters.per.sec))
ggplot(swimstats %>% filter(date>as.Date("2020-09-01"))) + geom_point(aes(meters,meters.per.sec))
ggplot(swimstats %>% filter(date>as.Date("2020-08-01"))) + geom_point(aes(meters,meters.per.sec))
ggplot(swimstats %>% filter(date>as.Date("2020-08-15"))) + geom_point(aes(meters,meters.per.sec))
View(swimstats)
# KBO Fancy Stats
source("~/Google Drive/KBO/2020elo.R")
# KBO Fancy Stats
source("~/Google Drive/KBO/2020elo.R")
exp(0.452)
exp(0.699)
exp(-0.796)
source("~/Google Drive/KBO/2020elo.R")
source("~/Google Drive/KBO/2020stats.R")
source("~/Google Drive/Futbol/c19update.R")
suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))
# Read in stats and fix times
swimstats <- read_csv("~/Google Drive/Personal Documents/swimstats.csv", col_types = cols())
swimstats$time <- duration(as.numeric(sub("s.*", "", swimstats$time)), "seconds")
swimstats$fast.50 <- duration(as.numeric(sub("s.*", "", swimstats$fast.50)), "seconds")
swimstats$fast.100 <- duration(as.numeric(sub("s.*", "", swimstats$fast.100)), "seconds")
swimstats$fast.200 <- duration(as.numeric(sub("s.*", "", swimstats$fast.200)), "seconds")
# Add new swim
newswim <- tibble(as_date("2020-10-07"), # Date
duration(60*66+19, "seconds"), # Time
2250, # Meters
596, # Calories
duration(47.7, "seconds"), # Fastest 50m Freestyle
duration(60*1+51, "seconds"), # Fastest 100m Freestyle
NA, # Fastest 200m Freestyle
900, # Longest Continuous Distance
2.53, # Meters Per Stroke (DPS)
3.18) # Seconds Per Stroke (Stroke Rate)
newswim[1,11] <- (newswim[1,9]/newswim[1,10]) # Meters Per Second
swimstats[(nrow(swimstats)+1),] <- newswim
# Overwrite csv
write_csv(swimstats,"~/Google Drive/Personal Documents/swimstats.csv")
# PRs and Totals
source("~/Google Drive/Personal Documents/swimpr.R")
# Plots
#ggplot(swimstats %>% filter(date>as.Date("2020-09-01"))) + geom_point(aes(date,meters.per.sec))
#ggplot(swimstats) + geom_point(aes(calories,meters))
View(swimstats)
# KBO Fancy Stats
source("~/Google Drive/KBO/2020elo.R")
# KBO Fancy Stats
source("~/Google Drive/KBO/2020elo.R")
View(predictions)
View(predictions)
View(results)
View(results)
pred.1
pred.2
634+86
source("~/Google Drive/KBO/2020stats.R")
source("~/Google Drive/Futbol/c19update.R")
## Updates
# KBO Fancy Stats
source("~/Google Drive/KBO/2020elo.R")
source("~/Google Drive/KBO/2020stats.R")
source("~/Google Drive/KBO/2020stats.R")
source("~/Google Drive/Futbol/c19update.R")
